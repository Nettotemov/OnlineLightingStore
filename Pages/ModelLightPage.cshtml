@page "/collections/{collectionName}/{modelName}"
@model ModelLightPage
@using System.Globalization

@{
	Layout = "_Layout";
	ViewData["Title"] = $"Купить модель освещения {@Model.LightModelPage?.Name} из коллекции " + @Model.CollectionName;
	ViewData["Breadcrumb"] = await Component.InvokeAsync("BreadcrumbSummary", new[] { (url: "/", page: "Главная"),
(url: "/collections", page:"Коллекции"), (url: "/collections/" + @Model.CollectionName, page:@Model.CollectionName),
(url: @Model.LightModelPage!.Name.ToString(), page:@Model.LightModelPage.Name) });
}

<div class="mt-13">
	<div class="col-12 border-b mb-per-4">
		<div class="row justify-content-between align-items-xl-center">
			<div class="col-12 col-xl-5">
				<div class="img-center__wrapper">
					<img class="img-responsive" src="@Model.LightModelPage.Img" alt="">
				</div>
			</div>
			<div class="col-md-12 col-xl-6 active">
				<h1 class="h1__caption mb-per-5">@Model.CollectionName - @Model.LightModelPage.Name</h1>
				<p class="p__caption mb-per-5">@Model.LightModelPage.Description</p>
			</div>
		</div>
	</div>
</div>
@if (@Model.LightModelPage is {AdditionalBlocks: not null })
{
	foreach (var item in @Model.LightModelPage.AdditionalBlocks)
	{
		<div class="col-12 border-b mb-per-4">
			<div class="row justify-content-between align-items-xl-center">
				<div class="col-12 col-xl-5">
					<div class="img-center__wrapper">
						<img class="img-responsive" src="@item.Url">
					</div>
				</div>
				<div class="col-md-12 col-xl-6 active">
					<h1 class="h1__caption mb-per-5">@item.Caption</h1>
					<p class="p__caption mb-per-5">@item.Description</p>
				</div>
			</div>
		</div>
	}
}

<div class="row">
	<h3 class="h3__caption fw-bold">Выбор модификации</h3>

	<div class="configurator-subproduct__wrapper mt-2 mb-5">
		<div class="configurator-subproduct row">
			<div class="col-12 col-xl-4">
				@if (@Model.ProductID != null)
				{
					<div class="configurator-img__wrapper">
						<img id="configuratorSubproductImg" class="img-center" src="@Model.Product?.MainPhoto">
					</div>
				}
				else
				{
					<div class="configurator-img__wrapper">
						<img id="configuratorSubproductImg" class="img-center"
							src="@Model.LightModelPage.Products.FirstOrDefault()?.MainPhoto">
					</div>
				}
			</div>
			<div class="col-12 col-xl-3 d-flex flex-column justify-content-center">
				@if (@Model.ProductID != null)
				{
					<h1 id="configuratorSubproductCaption" class="font-bold mb-2">@Model.ProductName</h1>

					<p id="configuratorProductPrice" class="h5 mb-4" price-value="@Model.Product!.Price.ToString()">
						Цена: @Model.Product.Price.ToString("C0", new CultureInfo("ru-RU"))</p>

					<a id="btn-arrow-3" class="arrow-3 mb-4 fw-bolder" asp-page="CardProduct" asp-route-ProductID="@Model.ProductID"
						asp-route-Url="@Model.Product.MetaData.Url">
						Подробнее о товаре
						<svg class="arrow-3-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32"
							viewBox="0 0 32 32">
							<g fill="none" stroke="#000" stroke-width="1.5" stroke-linejoin="round" stroke-miterlimit="10">
								<circle class="arrow-3-iconcircle" cx="16" cy="16" r="15.12"></circle>
								<path class="arrow-3-icon--arrow" d="M16.14 9.93L22.21 16l-6.07 6.07M8.23 16h13.98">
								</path>
							</g>
						</svg>
					</a>
				}
				else
				{
					<h1 id="configuratorSubproductCaption" class="font-bold text-muted">@Model.CollectionName -
						@Model.LightModelPage.Name</h1>
					@if (@Model.Products.Count() > 0)
					{
						<p id="configuratorProductPrice" class="h5 text-muted mb-4"
							price-value="@Model.Products.Select(p => p.Price).Min().ToString()">
							Цена: @Model.Products.Select(p => p.Price).Min().ToString("C0", new CultureInfo("ru-RU"))</p>
					}

					<a id="btn-arrow-3" class="disabled arrow-3 mb-4 fw-bolder" href="#">
						Подробнее о товаре
						<svg class="arrow-3-icon disabled" xmlns="http://www.w3.org/2000/svg" width="32" height="32"
							viewBox="0 0 32 32">
							<g fill="none" stroke="#000" stroke-width="1.5" stroke-linejoin="round" stroke-miterlimit="10">
								<circle class="arrow-3-iconcircle" cx="16" cy="16" r="15.12"></circle>
								<path class="arrow-3-icon--arrow" d="M16.14 9.93L22.21 16l-6.07 6.07M8.23 16h13.98">
								</path>
							</g>
						</svg>
					</a>
				}
				@if (@Model.ProductID != null)
				{
					<form id="ProductID" class="product-card__add addToCart" asp-page="/Cart" method="post">
						<div class="number">
							<span class="minus">-</span>
							<input id="quantity-count" class="quantity-count" name="quantityProducts" type="number"
								value="1" />
							<span class="plus">+</span>
						</div>
						<input id="configuratorProductId" type="hidden" asp-for="ProductID" />
						<input type="hidden" name="returnUrl" value="@ViewContext.HttpContext.Request.PathAndQuery()" />
						<button id="configuratorAddToCart" type="submit" class="addToCart__product-card form-catalog__text">
							Добавить в корзину
						</button>
					</form>
				}
				else
				{
					<form id="ProductID" class="product-card__add addToCart" asp-page="/Cart" method="post">
						<div class="number">
							<span class="minus">-</span>
							<input id="quantity-count" class="quantity-count" name="quantityProducts" type="number"
								value="1" />
							<span class="plus">+</span>
						</div>
						<input id="configuratorProductId" type="hidden" asp-for="ProductID" />
						<input type="hidden" name="returnUrl" value="@ViewContext.HttpContext.Request.PathAndQuery()" />
						<button id="configuratorAddToCart" type="submit" disabled
							class="addToCart__product-card-disabled form-catalog__text">
							Добавить в корзину
						</button>
					</form>
				}
			</div>
		</div>
	</div>

	<form id="collectionPageForm" method="get" asp-page="/CollectionPage" asp-page-handler="Params">
		<div class="row configurator-form__wrapper">
			<div class="col-12 col-xl-2 mb-3">
				<div class="configurator__wrapper select-model-name active">
					<h4 class="configurator__caption">Модель:</h4>
					<div id="result"></div>
					<div class="configurator__btns">
						<input type="hidden" id="configuratorModelName" name="modelName"
							value="@Model.LightModelPage?.Name">
						<div class="selectModelsProduct d-flex flex-column" id="selectModelsProduct">
							<button class="radio-btn active" type="button" name="@Model.LightModelPage?.Name"
								data-value="@Model.LightModelPage?.Name">@Model.LightModelPage?.Name</button>
						</div>
					</div>
				</div>
			</div>
			<div class="col-12 col-xl-3 col-xxl-2 col-lg-4 mb-3">
				@if (@Model.Products.Select(p => p.Color).Distinct().Count() >= 1 &&
						@Model.LightModelPage.Products.Select(p => p.Color).Distinct().Count() != 1)
				{
					<div class="configurator__wrapper select-color-product">
						<h4 class="configurator__caption">Цвет:</h4>
						<div class="configurator__btns">
							<input type="hidden" id="configuratorColorProduct" name="colorProduct" value="">
							<div class="selectColorsProduct d-flex flex-column" id="selectColorsProduct">
								@foreach (var color in @Model.LightModelPage.Products.Select(p => p.Color).Distinct())
								{

									@if (@Model.Products.Select(p => p.Color).Distinct().Where(p => p ==
											color).Any())
									{
										<button class="radio-btn" type="button" data-value="@color" name="@color">@color</button>
									}
									else
									{
										<button class="radio-btn" disabled type="button" data-value="@color"
											name="@color">@color</button>
									}
								}
							</div>
						</div>
					</div>
				}
				else
				{
					<div class="configurator__wrapper select-color-product active">
						<h4 class="configurator__caption">Цвет:</h4>
						<div class="configurator__btns">
							<input type="hidden" id="configuratorColorProduct" name="colorProduct"
								value="@Model.Products.Select(p => p.Color).Distinct().FirstOrDefault()">
							<div class="selectColorsProduct d-flex flex-column" id="selectColorsProduct">
								@foreach (var color in @Model.LightModelPage.Products.Select(p => p.Color).Distinct())
								{

									@if (color == @Model.Products.Select(p => p.Color).Distinct().FirstOrDefault())
									{
										<button class="radio-btn active" type="button" data-value="@color"
											name="@color">@color</button>
									}
									else
									{
										<button class="radio-btn" disabled type="button" data-value="@color"
											name="@color">@color</button>
									}
								}
							</div>
						</div>
					</div>
				}
			</div>
			<div class="col-12 col-xl-3 col-xxl-2 col-lg-4 mb-3">
				@if (@Model.Products.Select(p => p.Size).Distinct().Count() >= 1 &&
						@Model.LightModelPage.Products.Select(p => p.Size).Distinct().Count() != 1)
				{
					<div class="configurator__wrapper select-size-product">
						<h4 class="configurator__caption">Размер:</h4>
						<div class="configurator__btns">
							<input type="hidden" id="configuratorSizeProduct" name="size" value="">
							<div class="selectSizeProduct d-flex flex-column" id="selectSizeProduct">
								@foreach (var size in @Model.LightModelPage.Products.Select(p => p.Size).Distinct())
								{
									@if (@Model.Products.Select(p => p.Size).Distinct().Where(p => p ==
											size).Any())
									{
										<button class="radio-btn" type="button" data-value="@size" name="@size">@size</button>
									}
									else
									{
										<button class="radio-btn" disabled type="button" data-value="@size"
											name="@size">@size</button>
									}
								}
							</div>
						</div>
					</div>
				}
				else
				{
					<div class="configurator__wrapper select-size-product active">
						<h4 class="configurator__caption">Размер:</h4>
						<div class="configurator__btns">
							<input type="hidden" id="configuratorSizeProduct" name="size"
								value="@Model.Products.Select(p => p.Size).Distinct().FirstOrDefault()">
							<div class="selectSizeProduct d-flex flex-column" id="selectSizeProduct">
								@foreach (var size in @Model.LightModelPage.Products.Select(p => p.Size).Distinct())
								{
									@if (size == @Model.Products.Select(p => p.Size).Distinct().FirstOrDefault())
									{
										<button class="radio-btn active" type="button" data-value="@size"
											name="@size">@size</button>
									}
									else
									{
										<button class="radio-btn" disabled type="button" data-value="@size"
											name="@size">@size</button>
									}
								}
							</div>
						</div>
					</div>
				}
			</div>
			<div class="col-12 col-xl-3 col-xxl-2 col-lg-4 mb-3">
				@if (@Model.Products.Select(p => p.LightSource).Distinct().Count() >= 1 &&
						@Model.LightModelPage.Products.Select(p => p.LightSource).Distinct().Count() != 1)
				{
					<div class="configurator__wrapper select-light-source-product">
						<h4 class="configurator__caption">Источник света:</h4>
						<div class="configurator__btns">
							<input type="hidden" id="configuratorLightSourceProduct" name="lightSource" value="">
							<div class="selectLightSourceProduct d-flex flex-column" id="selectLightSourceProduct">
								@foreach (var lightSource in @Model.LightModelPage.Products.Select(p =>
										p.LightSource).Distinct())
								{
									@if (@Model.Products.Select(p => p.LightSource).Distinct().Where(p => p ==
											lightSource).Any())
									{
										<button class="radio-btn" type="button" data-value="@lightSource"
											name="@lightSource">@lightSource</button>
									}
									else
									{
										<button class="radio-btn" disabled type="button" data-value="@lightSource"
											name="@lightSource">@lightSource</button>
									}
								}
							</div>
						</div>
					</div>
				}
				else
				{
					<div class="configurator__wrapper select-light-source-product active">
						<h4 class="configurator__caption">Источник света:</h4>
						<div class="configurator__btns">
							<input type="hidden" id="configuratorLightSourceProduct" name="lightSource"
								value="@Model.Products.Select(p => p.LightSource).Distinct().FirstOrDefault()">
							<div class="selectLightSourceProduct d-flex flex-column" id="selectLightSourceProduct">
								@foreach (var lightSource in @Model.LightModelPage.Products.Select(p =>
										p.LightSource).Distinct())
								{
									@if (lightSource == @Model.Products.Select(p => p.LightSource).Distinct().FirstOrDefault())
									{
										<button class="radio-btn active" type="button" data-value="@lightSource"
											name="@lightSource">@lightSource</button>
									}
									else
									{
										<button class="radio-btn" disabled type="button" data-value="@lightSource"
											name="@lightSource">@lightSource</button>
									}
								}
							</div>
						</div>
					</div>
				}
			</div>
			<div class="col-12 col-xl-3 col-xxl-2 col-lg-4 mb-3">
				@if (@Model.Products.Select(p => p.PowerW).Distinct().Count() >= 1 &&
						@Model.LightModelPage.Products.Select(p => p.PowerW).Distinct().Count() != 1)
				{
					<div class="configurator__wrapper select-power-w-product">
						<h4 class="configurator__caption">Мощность:</h4>
						<div class="configurator__btns">
							<input type="hidden" id="configuratorPowerWProduct" name="powerW" value="">
							<div class="selectPowerWProduct d-flex flex-column" id="selectPowerWProduct">
								@foreach (var powerW in @Model.LightModelPage.Products.Select(p =>
										p.PowerW).Distinct())
								{

									@if (@Model.Products.Select(p => p.PowerW).Distinct().Where(p => p == powerW).Any())
									{
										<button class="radio-btn" type="button" data-value="@powerW" name="@powerW">@powerW</button>
									}
									else
									{
										<button class="radio-btn" disabled type="button" data-value="@powerW"
											name="@powerW">@powerW</button>
									}
								}
							</div>
						</div>
					</div>
				}
				else
				{
					<div class="configurator__wrapper select-power-w-product active">
						<h4 class="configurator__caption">Мощность:</h4>
						<div class="configurator__btns">
							<input type="hidden" id="configuratorPowerWProduct" name="powerW"
								value="@Model.Products.Select(p => p.PowerW).Distinct().FirstOrDefault()">
							<div class="selectPowerWProduct d-flex flex-column" id="selectPowerWProduct">
								@foreach (var powerW in @Model.LightModelPage.Products.Select(p =>
										p.PowerW).Distinct())
								{

									@if (powerW == @Model.Products.Select(p => p.PowerW).Distinct().FirstOrDefault())
									{
										<button class="radio-btn active" type="button" data-value="@powerW"
											name="@powerW">@powerW</button>
									}
									else
									{
										<button class="radio-btn" disabled type="button" data-value="@powerW"
											name="@powerW">@powerW</button>
									}
								}
							</div>
						</div>
					</div>
				}
			</div>

			<div class="col-12 col-xl-3 col-xxl-2 col-lg-4 mb-3">
				@if (@Model.Products.Select(p => p.AddControl).Distinct().Count() >= 1 &&
						@Model.LightModelPage.Products.Select(p => p.AddControl).Distinct().Count() != 1)
				{
					<div class="configurator__wrapper select-dim-product">
						<h4 class="configurator__caption">Управление:</h4>
						<div class="configurator__btns">
							<input type="hidden" id="configuratorDimProduct" name="dim" value="">
							<div class="selectDimProduct d-flex flex-column" id="selectDimProduct">
								@foreach (var dim in @Model.LightModelPage.Products.Select(p =>
										p.AddControl).Distinct())
								{
									@if (@Model.Products.Select(p => p.AddControl).Distinct().Where(p => p == dim).Any())
									{
										<button class="radio-btn" type="button" data-value="@dim" name="@dim">@dim</button>
									}
									else
									{
										<button class="radio-btn" disabled type="button" data-value="@dim" name="@dim">@dim</button>
									}
								}
							</div>
						</div>
					</div>
				}
				else
				{
					<div class="configurator__wrapper select-dim-product active">
						<h4 class="configurator__caption">Управление:</h4>
						<div class="configurator__btns">
							<input type="hidden" id="configuratorDimProduct" name="dim"
								value="@Model.Products.Select(p => p.AddControl).Distinct().FirstOrDefault()">
							<div class="selectDimProduct d-flex flex-column" id="selectDimProduct">
								@foreach (var dim in @Model.LightModelPage.Products.Select(p =>
										p.AddControl).Distinct())
								{

									@if (dim == @Model.Products.Select(p => p.AddControl).Distinct().FirstOrDefault())
									{
										<button class="radio-btn active" type="button" data-value="@dim" name="@dim">@dim</button>
									}
									else
									{
										<button class="radio-btn" disabled type="button" data-value="@dim" name="@dim">@dim</button>
									}
								}
							</div>
						</div>
					</div>
				}
			</div>

			@if (@Model.isCheckNumberOfProperties == true)
			{
				<div class="col-12 mt-3">
					<button id="clearConfigurator" class="form-catalog__text cart__btn-checkout d-none"
						type="button">Сбросить настройки</button>
				</div>
			}

		</div>
	</form>
</div>

<script src="~/js/configurator.js" asp-append-version="true" defer></script>