@page "/{url}"
@model CategoryPage
@using System.Globalization

@{
	Layout = "_Layout";
	ViewData["Title"] = @Model.CategoryCard.MetaData.Title;
	ViewData["Description"] = @Model.CategoryCard.MetaData.Description;
	ViewData["Breadcrumb"] = await Component.InvokeAsync("BreadcrumbSummary", new[] { (url: "/", page: "Главная"), (url:
"/category/" + @Model.CategoryCard!.Id.ToString(), page:@Model.CategoryCard?.CategoryName) });
}


<div class="mt-13">
	<div class="col-12 border-b mb-per-4">
		<div class="row justify-content-between align-items-xl-center">
			<div class="col-12 col-xl-5">
				<div class="img-center__wrapper">
					<img class="img-responsive" src="@Model.CategoryCard?.CategoryImg" alt="">
				</div>
			</div>
			<div class="col-md-12 col-xl-6 active">
				<h1 class="h1__caption mb-per-5">@Model.CategoryCard?.CategoryName</h1>
				<p class="p__caption mb-per-5">@Model.CategoryCard?.Description</p>
			</div>
		</div>
	</div>

	@if (Model.CategoryCard?.HeadingTwo != null && Model.CategoryCard?.ImgTwoUrl != null)
	{
		<div class="col-12 border-b mb-per-4">
			<div class="row justify-content-between align-items-xl-center">
				<div class="col-12 col-xl-5">
					<div class="img-center__wrapper">
						<img class="img-responsive" src="@Model.CategoryCard?.ImgTwoUrl" alt="">
					</div>
				</div>
				<div class="col-md-12 col-xl-6 active">
					<h1 class="h1__caption mb-per-5">@Model.CategoryCard?.HeadingTwo</h1>
					<p class="p__caption mb-per-5">@Model.CategoryCard?.DescriptionTwo</p>
				</div>
			</div>
		</div>
	}

	@if (@Model.CategoryCard?.HeadingThree != null && (@Model.CategoryCard?.ImgThreeUrl != null ||
			@Model.CategoryCard?.Slider != null))
	{
		<div class="col-12 border-b mb-per-4">
			<div class="row justify-content-between align-items-xl-center">
				@if (@Model.CategoryCard?.DisplaySlider == true && @Model.CategoryCard?.Slider != null)
				{
					<div class="col-12 col-xl-5">
						<div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="true">
							<div class="carousel-inner">
								@{
									int count = 0;
								}
								<div class="carousel-indicators">
									@for (int i = 0; i < @Model.CategoryCard?.Slider?.Split(',').ToList().Count(); i++)
									{
										<button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="@i"
											class="active" aria-current="true" aria-label="Slide @i"></button>
									}
								</div>
								@foreach (var img in @Model.CategoryCard?.Slider?.Split(',').ToList() ?? new List<string>())
								{

									@if (count == 0)
									{
										<div class="carousel-item active">
											<img src="@img" class="d-block w-100" alt="@Model.CategoryCard?.CategoryName">
										</div>
									}
									else
									{
										<div class="carousel-item">
											<img src="@img" class="d-block w-100" alt="@Model.CategoryCard?.CategoryName">
										</div>
									}
									count++;
								}
							</div>
							<button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators"
								data-bs-slide="prev">
								<span class="carousel-control-prev-icon" aria-hidden="true"></span>
								<span class="visually-hidden">Previous</span>
							</button>
							<button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators"
								data-bs-slide="next">
								<span class="carousel-control-next-icon" aria-hidden="true"></span>
								<span class="visually-hidden">Next</span>
							</button>
						</div>
					</div>
				}
				else
				{
					<div class="col-12 col-xl-5">
						<div class="img-center__wrapper">
							<img class="img-responsive" src="@Model.CategoryCard?.ImgThreeUrl" alt="">
						</div>
					</div>
				}
				<div class="col-md-12 col-xl-6 active">
					<h1 class="h1__caption mb-per-5">@Model.CategoryCard?.HeadingThree</h1>
					<p class="p__caption mb-per-5">@Model.CategoryCard?.DescriptionThree</p>
				</div>
			</div>
		</div>
	}
	
	@if (Model.ProductsByType is not null)
	{
		@foreach (var type in Model.ProductsByType)
		{
			<h3 class="h3__caption fw-bold">@type.Key</h3>
			<div class="catalog-list__wrapper mb-per-2">
				@foreach (var pr in type)
				{
					<a asp-page="CardProduct" class="product__wrapper" asp-route-ProductID="@pr.Id"
					   asp-route-Url="@pr.MetaData.Url">
						<div class="">
							<div class="product-img__wrapper">
								<img class="img-center" src="@pr.MainPhoto" alt="@pr.Name">
							</div>
							<div class="product-desc__wrapper">
								<p class="title-wrp">@pr.Name</p>
								<div class="product-price__wrapper">
									@if (@pr.Discount != null && @pr.OldPrice != null)
									{
									@* <p class="tags-wrp">-@pr.Discount%</p> *@
										<p class="tags-wrp"><s>@pr.OldPrice?.ToString("C0", new CultureInfo("ru-RU"))</s></p>
									}
									<p class="product-price">@pr.Price.ToString("C0", new CultureInfo("ru-RU"))</p>
								</div>
							</div>
						</div>
					</a>
				}
			</div>
		}
	}
</div>
