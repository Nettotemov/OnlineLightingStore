@page "/category/{CategoryName}"
@model CategoryPage

@{
	Layout = "_Layout";
	ViewData["Title"] = @Model.categoryCard?.CategoryName + " купить";
	ViewData["Breadcrumb"] = await Component.InvokeAsync("BreadcrumbSummary", new[] { (url: "/", page: "Главная"), (url:
"/catalog", page:"Каталог"), (url: "/category/" + @Model.categoryCard!.ID.ToString(), page:
@Model.categoryCard?.CategoryName) });
}


<div class="mt-13">
	<div class="col-12 border-b mb-per-4">
		<div class="row justify-content-between align-items-xl-center">
			<div class="col-12 col-xl-6">
				<div class="img-center__wrapper">
					<img class="img-responsive" src="@Model.categoryCard?.CategoryImg">
				</div>
			</div>
			<div class="col-md-5 col-xs-12 active">
				<h1 class="h1__caption mb-per-5">@Model.categoryCard?.CategoryName</h1>
				<p class="p__caption mb-per-5">@Model.categoryCard?.Description</p>
			</div>
		</div>
	</div>

	@if (@Model.categoryCard?.HeadingTwo != null && @Model.categoryCard?.ImgTwoUrl != null)
	{
		<div class="col-12 border-b mb-per-4">
			<div class="row justify-content-between align-items-xl-center">
				<div class="col-12 col-xl-6">
					<div class="img-center__wrapper">
						<img class="img-responsive" src="@Model.categoryCard?.ImgTwoUrl">
					</div>
				</div>
				<div class="col-md-5 col-xs-12 active">
					<h1 class="h1__caption mb-per-5">@Model.categoryCard?.HeadingTwo</h1>
					<p class="p__caption mb-per-5">@Model.categoryCard?.DescriptionTwo</p>
				</div>
			</div>
		</div>
	}

	@if (@Model.categoryCard?.HeadingThree != null && (@Model.categoryCard?.ImgThreeUrl != null ||
			@Model.categoryCard?.Slider != null))
	{
		<div class="col-12 border-b mb-per-4">
			<div class="row justify-content-between align-items-xl-center">
				@if (@Model.categoryCard?.DisplaySlider == true && @Model.categoryCard?.Slider != null)
				{
					<div class="col-12 col-xl-6">
						<div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="true">
							<div class="carousel-inner">
								@{
									int count = 0;
								}
								<div class="carousel-indicators">
									@for (int i = 1; i <= @Model.categoryCard?.Slider?.Split(',').ToList().Count(); i++)
									{
										<button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="@i"
											class="active" aria-current="true" aria-label="Slide @i"></button>
									}
								</div>
								@foreach (var img in @Model.categoryCard?.Slider?.Split(',').ToList() ?? new List<string>())
								{

									@if (count == 0)
									{
										<div class="carousel-item active">
											<img src="@img" class="d-block w-100" alt="@Model.categoryCard?.CategoryName">
										</div>
									}
									else
									{
										<div class="carousel-item">
											<img src="@img" class="d-block w-100" alt="@Model.categoryCard?.CategoryName">
										</div>
									}
									count++;
								}
							</div>
							<button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators"
								data-bs-slide="prev">
								<span class="carousel-control-prev-icon" aria-hidden="true"></span>
								<span class="visually-hidden">Previous</span>
							</button>
							<button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators"
								data-bs-slide="next">
								<span class="carousel-control-next-icon" aria-hidden="true"></span>
								<span class="visually-hidden">Next</span>
							</button>
						</div>
					</div>
				}
				else
				{
					<div class="col-12 col-xl-6">
						<div class="img-center__wrapper">
							<img class="img-responsive" src="@Model.categoryCard?.ImgThreeUrl">
						</div>
					</div>
				}
				<div class="col-md-5 col-xs-12 active">
					<h1 class="h1__caption mb-per-5">@Model.categoryCard?.HeadingThree</h1>
					<p class="p__caption mb-per-5">@Model.categoryCard?.DescriptionThree</p>
				</div>
			</div>
		</div>
	}


	@{
		var productsAndType = from product in @Model!.DisplayedProducts
									group product by product.ProductType?.Name;
	}
	@foreach (var type in productsAndType)
	{
		<h3 class="h3__caption fw-bold">@type.Key</h3>
		<div class="catalog-list__wrapper mb-per-2">
			@foreach (var pr in type)
			{
				<a asp-page="CardProduct" class="product__wrapper"
			asp-route-ProductID="@pr.ProductID" asp-route-Name="@pr.Name">
					<div class="">
						<div class="product-img__wrapper">
							<img class="img-center" src="@pr.MainPhoto">
						</div>
						<div class="product-desc__wrapper">
							<p class="title-wrp">@pr.Name</p>
							<div class="product-price__wrapper">
								@if (@pr.Discount != null && @pr.OldPrice != null)
								{
									@* <p class="tags-wrp">-@pr.Discount%</p> *@
									<p class="tags-wrp"><s>@pr.OldPrice?.ToString("C")</s></p>
								}
								<p class="product-price">@pr.Price.ToString("C")</p>
							</div>
						</div>
					</div>
				</a>
			}
		</div>
	}
</div>
